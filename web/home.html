<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Playlist Application</title>
    <link rel="icon" href="Logo.png"> <!-- Favicon path is relative -->
    <script src="https://kit.fontawesome.com/ef9a692198.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="home.css"> <!-- CSS file path is relative -->
    <script src="/logout.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // JavaScript for the toggle button
            var sidebar = document.getElementById('sidebar');
            var toggleButton = document.getElementById('sidebarToggle');
            var mainContent = document.querySelector('.main-content');

            // Get user ID from the URL query parameter
            const urlParams = new URLSearchParams(window.location.search);
            const userId = urlParams.get('id');

            // Update the links with the user ID
            document.querySelector('a[href="/home"]').href = "/home?userId=" + userId;
            document.querySelector('a[href="/users"]').href = "/users?userId=" + userId;
            document.querySelector('a[href="/music"]').href = "/music?userId=" + userId;
            document.querySelector('a[href="/analysis"]').href = "/analysis?userId=" + userId;

            toggleButton.addEventListener('click', function () {
                sidebar.classList.toggle('closed');
                mainContent.classList.toggle('fullwidth');
            });

            // Fetch recommended songs
            fetch('/recommendation/' + userId)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Received recommended songs:', data);
                    displayRecommendedSongs(data.recommendedSongs);
                })
                .catch(error => {
                    console.error('Error fetching recommended songs:', error);
                });

            function displayRecommendedSongs(recommendedSongs) {
                var mainContent = document.querySelector('.main-content');
                var recommendedSongsList = document.createElement('ul');
                recommendedSongsList.id = 'recommendedSongsList';

                if (!Array.isArray(recommendedSongs) || recommendedSongs.length === 0) {
                    mainContent.innerHTML = '<p>No recommended songs found</p>';
                }

                recommendedSongs.forEach(function (song) {
                    var listItem = document.createElement('li');
                    listItem.innerHTML =
                        '<i class="fas fa-play"></i> <span class="song-info"><strong>' +
                        song.data.musicName +
                        '</strong> - ' +
                        song.data.artist +
                        '</span> <div class="rating">' +
                        getStarIcons(song.data.rating) +
                        '</div>';
                    recommendedSongsList.appendChild(listItem);
                });

                mainContent.innerHTML = '<h1>Recommended Music For You</h1>';
                mainContent.appendChild(recommendedSongsList);
            }


            function getStarIcons(rating) {
                return '<i class="fas fa-star"></i>'.repeat(rating);
            }
        });
    </script>
</head>

<body>
    <div id="sidebar" class="sidebar">
        <button id="sidebarToggle" class="toggle-button">
            <span></span> <!-- This span is the middle line of the hamburger icon -->
        </button>
        <div class="logo">
            <a href="home.html">
                <img src="Logo.png" alt="Logo"> <!-- Logo image path is relative -->
            </a>
        </div>


        <div class="navigation">
            <ul>
                <li>
                    <a href="/home">
                        <span class="fa fa-home"></span>
                        <span>Home</span>
                    </a>
                </li>
            </ul>
        </div>
        <div class="navigation">
            <ul>
                <li>
                    <a href="/users">
                        <span class="fa fa-user"></span>
                        <span>Profile</span>
                    </a>
                </li>
                <li>
                    <a href="/music">
                        <span class="fa fas fa-book"></span>
                        <span>Your Library</span>
                    </a>
                </li>
                <li>
                    <a href="/analysis">
                        <span class="fa fa-search"></span>
                        <span>Analysis</span>
                    </a>
                </li>
            </ul>
        </div>

        <div class="policies">
            <ul>
                <li>
                    <a href="">Settings</a>
                </li>
                <li>
                    <a id="logoutButton" href="">Log out</a>
                </li>
            </ul>
        </div>
    </div>

    <div class="main-content">
        <h1>Recommended Music For You</h1>
    </div>

    <script>
        // JavaScript for the toggle button
        document.addEventListener('DOMContentLoaded', function () {
            var sidebar = document.getElementById('sidebar');
            var toggleButton = document.getElementById('sidebarToggle');
            var mainContent = document.querySelector('.main-content'); // Add this line

            toggleButton.addEventListener('click', function () {
                sidebar.classList.toggle('closed');
                mainContent.classList.toggle('fullwidth'); // Add this line
            });
        });
    </script>

</body>

</html>